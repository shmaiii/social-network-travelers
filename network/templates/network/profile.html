{% extends "network/layout.html" %} 
{% load static %}

{% block style %}
    <link href="{% static 'network/profile.css' %}" rel="stylesheet" >
{% endblock %}

{% block body %} 
    <div data-user_id = {{user.id}} id="personal-info">
        <div>
            <label id="username">
                {{user.username}}
            </label>
            <br>
            <div id="user-numbers" class="container">
                <div class="row">
                    <div class="col-sm"> {{posts_count}} posts</div>
                    <div class="col-sm"> {{followers}} followers</div>
                    <div class="col-sm"> {{following}} following</div>
                </div>
            </div>
            {% if user != request.user %}
                {% if followed %}
                    <button data-followed = "true" id="follow-btn"> Unfollow </button>
                {% else %}
                    <button data-followed = "false" id="follow-btn"> Follow </button>
                {% endif %}
            {% endif %}

        </div>
    </div>

    <hr>

    <div id="personal-posts">
        {% for post in posts %}
        <br>
        <div id="each-post">
             <label><a href="{% url 'profile' post.post_author post.post_author.id %}" >{{ post.post_author }}</a></label>
             <br />
             <p>{{ post.content }}</p>
             <!-- images go here -->
             <hr>
             <div style="display:flex; padding:0"> 
                 <div id="likes-num"> <button>Like</button><p>{{ post.likes }} likes</p></div>
                 <div id="comments-num"><button>Comment</button><p>{{ post.comments }} comments</p></div>
             </div>
             
         </div>
         {% endfor %}
    </div>


    <script src="https://unpkg.com/react@17/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <script type="text/babel">
        function Posts() {
            return null;
        }
       
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            let follow_btn = document.querySelector('#follow-btn');
            const user_id = document.querySelector('#personal-info').dataset.user_id;
            console.log(user_id);

            follow_btn.addEventListener('click', function() {
                if (follow_btn.innerHTML !== 'Follow') {
                    follow_btn.innerHTML = 'Follow';

                    fetch(`/follow/${user_id}`, {
                        method: 'PUT',
                        body: JSON.stringify({
                            follow: "unfollow"
                        }),
                        mode: 'same-origin',
                    })
                    .then(response => console.log(response));
                }
                else {
                    follow_btn.innerHTML = 'Unfollow';

                    fetch(`/follow/${user_id}`, {
                        method: 'PUT',
                        body: JSON.stringify({
                            follow: "follow"
                        }),
                        mode: 'same-origin',
                    })
                    .then(response => console.log(response));
                }
            });
        });
    </script>

{% endblock %}
